import time
import requests
import json


def download_file(url, file_path):
    try:
        response = requests.get(url, stream=True)        
        if response.status_code == 200:
            with open(file_path, 'wb') as file:
                for chunk in response.iter_content(chunk_size=1024):
                    if chunk:
                        file.write(chunk)
            print(f"File downloaded successfully to {file_path}")
        else:
            print(f"Failed to download file. Status code: {response.status_code}")
    except Exception as e:
        print(f"An error occurred: {e}")


def run_export_job(base_url, headers, subject_submitter_id_list):
    url = base_url + "/job/dispatch"

    payload = json.dumps({
      "action": "export",
      "input": {
        "filter": {
          "AND": [
            {
              "IN": {
                "subject_submitter_id": subject_submitter_id_list
              }
            }
          ]
        }
      }
    })
    

    response = requests.request("POST", url, headers=headers, data=payload)
    if response.status_code == 200:
        print("Success to run the job.")
        data = response.json()
        return data["uid"]
    else:
        print(f"Failed to run the job. Status code: {response.status_code}")
        print(response.text)
        return None


def get_job_status(base_url, headers, job_uid):
    url = base_url + "/job/status?UID=" + job_uid
    response = requests.request("GET", url, headers=headers)
    if response.status_code != 200:
        print("Error")
        print(response.text)
        exit()

    data = response.json()
    print(data["status"])
    return data["status"] == "Completed"
    

def get_job_output(base_url, headers, job_uid):
    url = base_url + "/job/output?UID=" + job_uid
    response = requests.request("GET", url, headers=headers)
    if response.status_code != 200:
        print("Error")
        print(response.text)
        return None

    data = response.json()
    return data["output"]




local_file_path = "./pfb_to_zip/"
file_name = "20250115_INSTRuCT_2022-10.avro"
base_url = "https://portal.pedscommons.org"
access_token = "YOUR_ACCESS_TOKEN"
subject_submitter_id_list = [
                "MMT_30127279","MMT_10634044","COG_PAUIZW","MMT_30036425","CWS_5395","MMT_30176982","COG_PASHNI","EpSSG_2577","EpSSG_2868","CWS_3290","MMT_30306039","MMT_30176316","CWS_8991","EpSSG_583","EpSSG_1473","EpSSG_3093","EpSSG_845","CWS_6216","EpSSG_4126","CWS_9000","EpSSG_1939","CWS_5237","CWS_6223","MMT_30086699","CWS_5844","MMT_30327039","COG_PATPKY","CWS_3055","COG_PARPTX","COG_PARTVI","COG_PATRNU","CWS_3572","COG_PASMPM","MMT_30616994","CWS_5195","EpSSG_2693","CWS_6213","MMT_20135041","MMT_10534464","MMT_10674073","CWS_5220","COG_PARCGJ","CWS_9311","MMT_30177270","MMT_30636423","MMT_10534267","EpSSG_2003","CWS_5009","CWS_8140","EpSSG_930","CWS_8403","EpSSG_2493","MMT_30366732","COG_PAUEYK","CWS_5549","EpSSG_2597","EpSSG_3626","CWS_8941","MMT_20075105","COG_PATIJJ","CWS_8038","CWS_5420","CWS_9424","MMT_30086877","EpSSG_789","CWS_5977","MMT_30016234","EpSSG_2440","EpSSG_977","COG_PARFAV","EpSSG_2078","COG_PATZGI","EpSSG_84","MMT_10814428","CWS_5976","CWS_5621","CWS_9064","MMT_30636063","CWS_8248","CWS_8039","CWS_9218","EpSSG_761","EpSSG_1195","EpSSG_1181","MMT_30636148","CWS_6032","EpSSG_978","CWS_5762","CWS_5353","MMT_30336010","EpSSG_3514","EpSSG_253","EpSSG_852","EpSSG_4168","CWS_5932","COG_PASCAD","CWS_8412","CWS_5465","CWS_9257","CWS_5638","EpSSG_3117","MMT_10694411","COG_PAUALT","CWS_5441","EpSSG_242","CWS_6012","CWS_8171","EpSSG_1104","CWS_3035","CWS_6031","MMT_20015099","EpSSG_1289","COG_PAULGS","MMT_30216963","COG_PASIGL","CWS_9409","CWS_5171","MMT_30626622","CWS_9216","MMT_30017019","CWS_8159","EpSSG_3816","CWS_5411","EpSSG_1143","COG_PARTUR","COG_PAURGB","EpSSG_3678","COG_PASLXE","CWS_3620","MMT_30176181","CWS_3470","MMT_30016643","CWS_6171","COG_PAREVI","CWS_5702","EpSSG_951","CWS_8117","COG_PARAZC","EpSSG_3067","CWS_9346","MMT_30076496","EpSSG_1862","EpSSG_112","CWS_3149","EpSSG_2328","EpSSG_2294","EpSSG_1804","EpSSG_2338","EpSSG_939","EpSSG_1443","EpSSG_2412","EpSSG_500","COG_PARHDR","CWS_9074","CWS_5231","CWS_9369","EpSSG_2034","EpSSG_883","MMT_10624597","EpSSG_1044","EpSSG_3303","CWS_5088","EpSSG_470","COG_PASYLT","EpSSG_974","CWS_6153","EpSSG_298","EpSSG_2482","EpSSG_1481","CWS_3542","COG_PATICR","EpSSG_2449","EpSSG_3728","EpSSG_2761","COG_PATLXT","MMT_10694587","CWS_9315","CWS_9013","EpSSG_2683","MMT_10614681","EpSSG_1808","MMT_30036546","EpSSG_552","COG_PAUTNX","MMT_30636691","CWS_8024","CWS_3367","EpSSG_1502","CWS_9031","MMT_30366589","CWS_8928","EpSSG_3181","EpSSG_3259","CWS_9041","CWS_8137","EpSSG_1864","MMT_30156870","MMT_30106748","COG_PASDHP","CWS_8917","EpSSG_1090","CWS_4006","EpSSG_3881","EpSSG_138","EpSSG_776","MMT_30176804","CWS_5697","CWS_8032","EpSSG_888","EpSSG_123","MMT_10514548","EpSSG_895","COG_PATXNC","CWS_5942","COG_PAUTTU","MMT_30016235","EpSSG_2517","EpSSG_3969","MMT_30306037","COG_PASSDH","MMT_30126922","EpSSG_2020","CWS_8152","EpSSG_2888","MMT_30306031","MMT_30306372","CWS_8194","MMT_30606343","CWS_3490","MMT_10634384","CWS_5985","COG_PAUMAE","CWS_8094","EpSSG_1039","EpSSG_3292","EpSSG_1074","EpSSG_115","EpSSG_3076","CWS_5377","EpSSG_2436","EpSSG_2313","EpSSG_1624","CWS_3568","COG_PARJFJ","MMT_10564427","MMT_30036135","CWS_5326","EpSSG_1368","EpSSG_175","CWS_9072","EpSSG_2854","CWS_8293","CWS_8940","MMT_30127052","CWS_8150","EpSSG_83","COG_PASDKG","MMT_30027119","EpSSG_239","EpSSG_1482","CWS_8093","CWS_5144","EpSSG_3632","EpSSG_921","COG_PAPZMN","CWS_5384","CWS_6230","COG_PAUAMD","CWS_3132","EpSSG_4018","MMT_30017225","EpSSG_3595","COG_PATVBW","EpSSG_3989","CWS_3511","MMT_30097117","EpSSG_3656","MMT_10594447","EpSSG_401","COG_PASSWT","CWS_5659","CWS_8301","EpSSG_3020","CWS_5407","EpSSG_3390","CWS_5034","EpSSG_3246","EpSSG_370","COG_PATAVV","MMT_10554004","COG_PARCSZ","EpSSG_922","CWS_5111","CWS_9278","CWS_3417","MMT_10694162","CWS_3339","CWS_8045","EpSSG_2012","COG_PATWGM","EpSSG_3707","CWS_5920","MMT_30116826","COG_PARYBA","EpSSG_1614","COG_PARZRE","EpSSG_2755","EpSSG_11","MMT_10564398","EpSSG_2523","CWS_3525","CWS_5391","MMT_10524040","EpSSG_1147","EpSSG_1063","EpSSG_4105","MMT_10554656","COG_PARCPW","EpSSG_107","COG_PARYXF","EpSSG_729","EpSSG_2909","COG_PATFGY","MMT_10674258","CWS_3492","EpSSG_2877","CWS_3379","CWS_6184","CWS_5307","CWS_3400","COG_PAUICG","CWS_8484","MMT_30636874","CWS_8254","EpSSG_2609","CWS_8156","CWS_8004","COG_PARKAN","COG_PASCMP","CWS_3622","CWS_5404","CWS_3141","CWS_6020","MMT_30016284","EpSSG_1885","CWS_8089","CWS_6241","MMT_30017007","MMT_10524128","EpSSG_2142","CWS_8486","COG_PAUNZV","CWS_5885","MMT_10584474","EpSSG_2773","CWS_8105","EpSSG_1724","CWS_5036","CWS_5318","MMT_10624506","COG_PAUIIG","EpSSG_3022","CWS_5816","CWS_9429","EpSSG_1196","CWS_5827","EpSSG_1718","EpSSG_1999","CWS_9438","EpSSG_117","EpSSG_411","COG_PATKSJ","CWS_3206","CWS_6095","EpSSG_925","EpSSG_2885","CWS_8348","CWS_3250","COG_PATHWK","CWS_3406","CWS_8109","EpSSG_299","EpSSG_3644","COG_PATBBL","COG_PARZYE","CWS_9271","MMT_30016223","EpSSG_1128","CWS_6055","EpSSG_3463","MMT_30026358","CWS_8314","MMT_30307205","COG_PAUGHZ","CWS_5068","COG_PASBRX","COG_PAUJTR","EpSSG_1432","EpSSG_2468","EpSSG_2212","EpSSG_706","COG_PATJBE","EpSSG_3260","COG_PASDMZ","COG_PASKHP","EpSSG_207","COG_PASEKE","EpSSG_1799","CWS_9423","CWS_3330","MMT_30156299","EpSSG_1233","CWS_8343","EpSSG_1972","EpSSG_752","CWS_6019","CWS_9037","EpSSG_2534","MMT_10674249","CWS_3251","COG_PARHCF","EpSSG_3416","CWS_5265","EpSSG_465","CWS_6088","CWS_8073","COG_PASNJU","EpSSG_50","CWS_5943","EpSSG_863","MMT_30026100","CWS_8158","CWS_5186","MMT_20135052","EpSSG_3095","EpSSG_2670","MMT_30137141","COG_PASLZR","EpSSG_1457","COG_PAUKAD","CWS_3010","MMT_30016122","CWS_5488","COG_PAUHGR","EpSSG_2092","EpSSG_2409","CWS_9300","MMT_30346743","CWS_8376","MMT_10644053","EpSSG_2632","EpSSG_1817","CWS_8101","CWS_5159","CWS_6094","CWS_8176","EpSSG_627","EpSSG_2480","EpSSG_2268","COG_PAUDJS","EpSSG_3668","MMT_30146353","EpSSG_2266","MMT_30177146","MMT_10524363","MMT_30167271","CWS_5394","CWS_8969","EpSSG_1040","CWS_5506","MMT_30016339","EpSSG_2360","CWS_5157","CWS_3118","EpSSG_864","MMT_30117278","CWS_5710","CWS_3468","EpSSG_3437","EpSSG_2161","CWS_5012","CWS_5632","MMT_30016656","MMT_10684476","CWS_9368","EpSSG_1144","CWS_5547","EpSSG_3714","EpSSG_2046","EpSSG_1660","EpSSG_3937","EpSSG_2402","MMT_30116755","CWS_8908","COG_PAUIVN","EpSSG_2845","CWS_6215","COG_PATHMP","EpSSG_1352","MMT_30337116","EpSSG_1778","MMT_30216274","CWS_3244","CWS_9410","CWS_8966","EpSSG_1235","EpSSG_3549","EpSSG_3631","MMT_30266152","MMT_10694545","CWS_9309","EpSSG_1418","CWS_3214","COG_PASKEC","MMT_10814523","COG_PAUAWU","EpSSG_333","EpSSG_1792","EpSSG_2694","EpSSG_1212","COG_PAUKJW","EpSSG_102","COG_PATWVE","EpSSG_407","EpSSG_142","EpSSG_3315","CWS_8347","CWS_5706","COG_PASHKN","EpSSG_4083","EpSSG_27","EpSSG_285","CWS_5633","CWS_8374","EpSSG_556","EpSSG_1232","MMT_30017069","CWS_8341","COG_PASAMA","CWS_3151","EpSSG_2753","EpSSG_2434","CWS_5682","EpSSG_3769","MMT_30636422","CWS_5667","CWS_6118","MMT_30306514","EpSSG_3951","EpSSG_2315","EpSSG_2070","COG_PASUIJ","CWS_5542","COG_PARXLB","EpSSG_1636","EpSSG_17","EpSSG_2330","COG_PATNTW","CWS_5867","COG_PAUHCM","EpSSG_2479","EpSSG_1535","CWS_6022","CWS_9044","MMT_10634131","MMT_30187228","EpSSG_1088","MMT_30026783","COG_PATWFW","CWS_9030","CWS_9127","CWS_3535","CWS_9012","EpSSG_2548","CWS_3426","EpSSG_1857","CWS_9108","CWS_3003","EpSSG_2163","EpSSG_206","EpSSG_540","CWS_8318","EpSSG_873","EpSSG_2940","CWS_5986","CWS_5580","COG_PATCUJ","EpSSG_3066","MMT_10814509","EpSSG_251","MMT_30126360","CWS_8100","EpSSG_4034","EpSSG_2804","MMT_10514550","CWS_3030","MMT_30137186","EpSSG_2778","EpSSG_1752","EpSSG_3690","EpSSG_3168","EpSSG_2490","EpSSG_1250","EpSSG_3689","CWS_8971","CWS_5912","CWS_6212","CWS_8181","CWS_9096","CWS_5255","MMT_10724112","EpSSG_111","EpSSG_1733","CWS_3041","CWS_6079","EpSSG_3799","CWS_6209","CWS_3529","COG_PAUPKK","EpSSG_200","COG_PARAPM","CWS_6021","CWS_5514","CWS_5646","CWS_5134","EpSSG_2108","COG_PATGNH","EpSSG_1743","CWS_5104","MMT_30636026","MMT_30156097","CWS_5495","MMT_20205035","CWS_3446","COG_PASPGE","EpSSG_2883","COG_PARVMV","CWS_3599","CWS_8286","CWS_9360","EpSSG_2968","COG_PAUPHL","CWS_3263","CWS_6098","EpSSG_1570","EpSSG_3245","EpSSG_1732","CWS_5126","EpSSG_1833","EpSSG_1050","CWS_5925","CWS_5179","MMT_10544035","CWS_8967","CWS_3471","COG_PATSIE","COG_PAUMPE","MMT_10724111","CWS_5582","EpSSG_228","EpSSG_3938","EpSSG_933","EpSSG_2331","MMT_30636977","CWS_5075","EpSSG_3429","CWS_5217","COG_PATWSV","CWS_5080","CWS_9275","COG_PATMUR","CWS_8174","EpSSG_209","EpSSG_524","MMT_30017171","MMT_30176393","EpSSG_1659","CWS_9100","CWS_5573","CWS_6173","EpSSG_3943","COG_PASTZX","EpSSG_1938","CWS_5869","EpSSG_125","EpSSG_1163","CWS_9080","EpSSG_4108","CWS_8160","MMT_10634310","EpSSG_1532","CWS_3260","EpSSG_785","EpSSG_707","EpSSG_1097","EpSSG_3409","COG_PASYLC","EpSSG_1676","CWS_8155","CWS_6126","CWS_3213","CWS_5837","CWS_8329","COG_PATZSG","MMT_30177124","COG_PASXBG","EpSSG_1827","EpSSG_1895","EpSSG_2546","EpSSG_1568","EpSSG_2432","CWS_6011","EpSSG_2919","CWS_3315","CWS_5358","CWS_9019","EpSSG_2663","COG_PASYIM","CWS_6000","CWS_9129","EpSSG_740","COG_PASRLD","MMT_30176319","COG_PASNZX","EpSSG_935","CWS_3318","EpSSG_119","CWS_9075","EpSSG_2039","EpSSG_3522","EpSSG_1425","CWS_8414","EpSSG_3299","CWS_3333","COG_PATZTD","CWS_3554","MMT_30236397","EpSSG_1201","CWS_5165","EpSSG_602","CWS_9420","MMT_10654208","EpSSG_2307","EpSSG_477","EpSSG_1742","COG_PAUPPU","MMT_10624378","EpSSG_165","MMT_30016476","MMT_30076220","CWS_5622","EpSSG_1027","EpSSG_2938","CWS_6144","CWS_8169","EpSSG_2204","EpSSG_1828","MMT_30016285","COG_PARJRK","EpSSG_73","MMT_30637079","EpSSG_660","CWS_5070","MMT_30126437","CWS_8415","MMT_30236828","CWS_8339","EpSSG_160","CWS_5213","COG_PATNRM","CWS_5114","EpSSG_1393","EpSSG_1153","CWS_8141","EpSSG_1873","EpSSG_2777","EpSSG_2355","CWS_9251","CWS_3596","COG_PASLWG","COG_PASMSH","CWS_9122","COG_PAUSZC","EpSSG_508","EpSSG_2141","CWS_9187","CWS_6005","CWS_5578","MMT_10664356","EpSSG_2786","EpSSG_3073","MMT_10684417","EpSSG_174","CWS_5323","CWS_3301","MMT_30126216","MMT_10524598","EpSSG_2801","EpSSG_4044","EpSSG_1477","CWS_8006","CWS_9366","EpSSG_18","EpSSG_2600","CWS_8420","CWS_8907","CWS_5418","CWS_3560","EpSSG_4009","MMT_30307194","MMT_30026914","COG_PATUIB","CWS_5956","CWS_8497","MMT_20205019","EpSSG_3345","CWS_8216","CWS_3305","COG_PATIEG","CWS_8200","CWS_5428","EpSSG_3608","CWS_5950","EpSSG_413","EpSSG_3524","EpSSG_684","CWS_5855","EpSSG_2818","CWS_9264","EpSSG_159","EpSSG_383","COG_PAUHDT","COG_PATSUE","EpSSG_3438","CWS_5789","CWS_5988","EpSSG_1472","MMT_30706555","MMT_10584478","EpSSG_975","MMT_30016489","EpSSG_2754","EpSSG_3019","MMT_30347267","MMT_30327035","EpSSG_2622","EpSSG_2492","CWS_8988","CWS_5008","MMT_30327176","EpSSG_3804","MMT_10584652","EpSSG_490","EpSSG_1577","MMT_30176446","CWS_9021","MMT_10604024","MMT_30126361","EpSSG_337","MMT_10514219","EpSSG_1928","EpSSG_2168","MMT_30626863","EpSSG_2701","MMT_30046893","EpSSG_1771","EpSSG_570","EpSSG_1452","EpSSG_3941","MMT_10724201","CWS_3495","COG_PAUPJK","MMT_30116756","EpSSG_369","COG_PAUAHI","COG_PAUBPZ","MMT_30176610","COG_PAUHKH","MMT_20285065","EpSSG_3926","EpSSG_1234","MMT_20025075","EpSSG_3132","CWS_5148","CWS_5122","EpSSG_1805","CWS_5209","CWS_8161","EpSSG_2008","CWS_9131","EpSSG_2752","EpSSG_1320","EpSSG_1357","CWS_8151","COG_PASMGI","COG_PARMAN","MMT_10634182","COG_PASUVW","EpSSG_2969","EpSSG_2351","EpSSG_585","MMT_10754326","COG_PASYLZ","EpSSG_3677","EpSSG_268","MMT_30216777","CWS_8372","CWS_5029","EpSSG_498","EpSSG_1935","EpSSG_1191","COG_PAUGMZ","MMT_30176533","EpSSG_3537","EpSSG_3590","MMT_30126884","MMT_30326958","MMT_30326708","EpSSG_3338","COG_PASEKM","MMT_30307211","EpSSG_1585","EpSSG_4109","CWS_6001","CWS_8989","MMT_30176250","COG_PAUSDE","EpSSG_3424","COG_PATCFF","CWS_3410","CWS_8480","CWS_9296","COG_PATZYX","COG_PATJFW","CWS_8998","CWS_8356","EpSSG_3000","EpSSG_1844","COG_PASBAB","COG_PATCLI","CWS_5983","EpSSG_3579","CWS_8107","COG_PATZKU","EpSSG_195","EpSSG_2614","EpSSG_3462","EpSSG_2103","CWS_5671","CWS_3276","CWS_5627","MMT_10584290","MMT_30176167","EpSSG_3993","CWS_3153","CWS_8373","EpSSG_82","CWS_8389","MMT_10744425","EpSSG_2639","CWS_9234","CWS_9136","EpSSG_2586","CWS_9288","MMT_30126290","EpSSG_1691","EpSSG_3364","MMT_30666849","CWS_6196","EpSSG_2676","CWS_3348","EpSSG_4085","MMT_10684409","EpSSG_866","EpSSG_2045","CWS_6104","COG_PATDXL","EpSSG_1170","EpSSG_3321","EpSSG_4016","MMT_30117219","CWS_8243","COG_PASVPY","EpSSG_885","MMT_30046694","CWS_5859","COG_PAUAPZ","CWS_5493","EpSSG_3623","EpSSG_2424","EpSSG_3991","EpSSG_2223","EpSSG_3764","EpSSG_1326","CWS_8133","EpSSG_1265","MMT_30176160","CWS_5958","CWS_5290","COG_PAUHWI","MMT_30626629","EpSSG_2791","COG_PATFNX","CWS_3289","EpSSG_2886","COG_PATGMW","CWS_9043","CWS_8915","MMT_30016363","EpSSG_2372","CWS_8223","MMT_10554403","CWS_8483","EpSSG_2620","EpSSG_3858","COG_PARFGJ","CWS_3034","EpSSG_2866","MMT_30086569","CWS_5267","EpSSG_3387","COG_PATAGK","EpSSG_2327","EpSSG_271","CWS_6092","CWS_5423","CWS_9056","CWS_5481","CWS_5930","CWS_9408","CWS_5501","EpSSG_2341","EpSSG_858","COG_PASFNJ","CWS_5722","CWS_5189","MMT_30636659","CWS_5017","COG_PAUAFZ","EpSSG_3242","EpSSG_1703","EpSSG_646","CWS_6111","COG_PATPTL","EpSSG_1953","MMT_30136889","EpSSG_2524","CWS_5948","EpSSG_86","COG_PAUBPR","CWS_8438","EpSSG_3326","EpSSG_1504","CWS_9412","COG_PARXAP","MMT_30347028","MMT_30177260","CWS_5594","CWS_6193","CWS_5570","EpSSG_69","COG_PATNSK","EpSSG_4156","EpSSG_1776","EpSSG_3780","EpSSG_2076","MMT_30017174","EpSSG_3293","CWS_5038","EpSSG_3119","CWS_5916","EpSSG_463","COG_PASUTY","MMT_30036880","EpSSG_3282","CWS_8164","MMT_30316458","MMT_30016616","EpSSG_2867","CWS_5432","EpSSG_1598","CWS_3066","CWS_6044","EpSSG_1936","COG_PATKPJ","CWS_9081","EpSSG_3956","MMT_20285074","EpSSG_3061","COG_PASUJU","EpSSG_176","MMT_30176474","EpSSG_2104","CWS_5965","EpSSG_3759","CWS_5832","EpSSG_2485","CWS_8087","EpSSG_1549","EpSSG_1377","EpSSG_1231","EpSSG_545","EpSSG_962","EpSSG_739","CWS_5519","EpSSG_640","CWS_9195","CWS_9235","CWS_5242","EpSSG_365","EpSSG_2156","MMT_30086106","CWS_9024","COG_PASLLT","CWS_5174","EpSSG_2456","EpSSG_145","EpSSG_249","EpSSG_2992","COG_PATEIP","COG_PASTJB","CWS_9320","CWS_8118","CWS_8124","CWS_8229","COG_PATARH","EpSSG_3455","CWS_8188","EpSSG_3543","EpSSG_741","COG_PAUEVB","CWS_8183","CWS_6117","EpSSG_3444","CWS_8959","CWS_3541","CWS_8344","EpSSG_860","MMT_30016249","EpSSG_625","EpSSG_1237","EpSSG_1226","CWS_5013","CWS_3205","EpSSG_1887","EpSSG_2689","EpSSG_2911","CWS_3393","CWS_3020","EpSSG_3592","EpSSG_1800","COG_PASSKM","CWS_3039","MMT_30626630","EpSSG_3701","EpSSG_3607","EpSSG_3888","CWS_3102","CWS_8386","CWS_5769","MMT_10694673","EpSSG_643","EpSSG_1838","EpSSG_3316","CWS_3246","MMT_30636421","COG_PATPKX","CWS_5416","EpSSG_2871","COG_PATRGB","CWS_9058","MMT_30306911","EpSSG_205","EpSSG_3580","EpSSG_2148","EpSSG_1411","EpSSG_1174","CWS_5619","COG_PARGXY","CWS_3094","EpSSG_768","MMT_10634406","MMT_30016809","CWS_8070","CWS_6228","EpSSG_592","EpSSG_2422","MMT_10524314","MMT_10634422","COG_PASESG","EpSSG_1089","MMT_30636568","CWS_5518","COG_PARCYC","CWS_5560","EpSSG_1272","COG_PARENL","EpSSG_447","CWS_9087","CWS_3356","COG_PATAVE","EpSSG_815","CWS_8375","CWS_5777","MMT_30326784","CWS_5253","EpSSG_2974","MMT_10674175","EpSSG_3835","EpSSG_1533","EpSSG_3062","EpSSG_4030","CWS_5540","COG_PAUFNH","EpSSG_2535","CWS_8406","COG_PAUHZM","MMT_30176380","CWS_5797","CWS_6222","EpSSG_1343","CWS_5652","MMT_30056625","CWS_5835","MMT_30016196","MMT_10764102","EpSSG_3096","CWS_5812","EpSSG_409","CWS_9115","EpSSG_1611","MMT_10584392","EpSSG_3961","MMT_30016362","COG_PAUADF"
    ]


headers = {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + access_token
    }


start_time = time.time()
job_uid = run_export_job(base_url, headers, subject_submitter_id_list)
if not job_uid:
    exit()
print(job_uid)

while not get_job_status(base_url, headers, job_uid):
    elapsed_time = time.time() - start_time
    print(f"Time since start: {elapsed_time:.2f} seconds")
    time.sleep(10)
    
dowload_url = get_job_output(base_url, headers, job_uid)
if dowload_url is None or dowload_url == "":
    print("ERROR")
    print(dowload_url)
    exit()
else:
    print("Dowloading...")
    download_file(dowload_url, local_file_path + file_name)

print(f"PROCESS FINISHED, you should find the downloaded file at {local_file_path + file_name}")






